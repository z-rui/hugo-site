---
date: 2016-04-19T01:29:00+08:00
title: CMOS三角波生成器
---

{{<figure src="/media/cmos-triangle-wave-generator-1.svg" >}}

## 原理

要生成三角波，可以考虑用电流源给电容器充电/放电。因为电容的伏安关系式为
\\[i = C{{\rm d}u\over{\rm d}t},\\]
所以只要通过的电流恒定，电容两端的电压就会线性地变化。

{{<figure src="/media/cmos-triangle-wave-generator-2.svg" >}}

如图所示的原理电路中，左边是两个方向相反的电流源（通常，从电源抽取电流的称为电流源，将电流流入地的称为电流阱），经过一个单刀双掷开关，轮流地给电容充放电。

但是这个开关要能实现自动地切换，才能实现给电容轮流充放电的功能。所以希望这个开关是受电压控制的开关，当控制电压为高电平时开关拨向上面，而低电平时拨向下面。

这个控制信号可以由施密特触发器产生。如图所示，电容上端电平送入一个反相的施密特触发器，当输入电平上升至上门限电压时，施密特触发器输出突变为低电平，当输入电平下降至下门限电压时，输出突变为高电平。这样就实现了控制信号的生成。

<!--more-->

## 实现

下面用CMOS电路依次实现各个组成部分。

### 电流源

电流源可以用PMOS构成，其结构如下。

{{<figure src="/media/cmos-triangle-wave-generator-3.svg" >}}

M1和M2因为\\(V\_{GS}\\)相等，所以当它们都处于饱和区时，它们的源极电流一定相等。对于M1而言，因为漏极和栅极短接，所以总是处于饱和区。 而M2在漏极电位较低(对于三角波生成器而言，即所接入的电容还未充满，其上的电压较小)，\\(\left|V\_{DS}\right|\\)足够大，也工作在饱和区。

M3是有源负载，作用是确定基准电流\\(I\_{REF}\\)。此处也可以用一个电阻，电阻越大，则\\(I\_{REF}\\)越小。因此电流源的电流可以根据需要设置。当电流源工作时，M1和M2源极电流都等于\\(I\_{REF}\\)，因此这个电路也称为**镜像电流源**。

电流阱则对称地用NMOS构成。

### 压控开关

压控开关使用一对MOSFET实现，其结构如下。

{{<figure src="/media/cmos-triangle-wave-generator-4.svg" >}}

当栅极为高电平而源极为低电平时，上面的NMOS导通，下面的PMOS截止；反之亦然。

对于三角波生成电路而言，当电容电压较低时，电路应该处于充电过程，所以压控开关的控制电压为较高；反之亦然。这样的工作情况使得此压控开关总能够正常工作。

### 施密特触发器

施密特触发器的CMOS电路如下。

{{<figure src="/media/cmos-triangle-wave-generator-5.svg" >}}

对该电路做如下分析：

1. 输入高电平，输出为低电平。这是一个稳定状态。M1~M4的栅极为高电平，因此PMOS截止，NMOS导通。但是因为M6的栅极为低电平截止，M3和M4的漏、源极之间没有偏压，所以没有电流流过。M5的栅极为低电平，\\(V\_{GD}=0\\)，使得M1的漏极被拉至低电平。(如果M1的漏极电平比较高，则M5将工作于饱和状态，会有电流通过M5流至地，但是M1和M2都是截止状态，不可能有这个电流。)
2. 输入从高电平开始下降，M1开始导通，但是因为M5工作在饱和状态，拉低了M1的漏极(M2的源极)电平，M2没有导通的机会。
3. 输入电平继续下降，M1导通程度增加，M1的漏极(M2的源极)电平也逐渐升高。直到M2的\\(-V\_{GS}\\)足够大，则M2开始导通，造成M5的栅极电压上升，从而M2开始截止，造成M2的源极电平进一步升高……这是一个正反馈过程，因此电路状态会在瞬间发生突变：输出变成高电平。这时的输入电平称为下门限电压\\(V\_{T-}\\)。
4. 输出变成低电平以后，电路为另一个稳定状态。即使这时输入电平立刻回升，电路的输出也不会立刻变回去。这是因为输出突变成高电平后，M5截止，而M1, M2导通，所以M2的源极电平也比突变之前增大了很多，输入电平即使回升，\\(-V\_{GS}\\)也足够大而不足以使得M2截止，所以电路不会立刻回到之前的状态。
5. 输入电平如果继续下降，则电路维持稳态，对此不做分析。现在设输入电平上升，则M6工作在饱和状态，M4导通程度增加，M3电平开始下降。输入电平不断上升直到M3的\\(V\_{GS}\\)足够大，M3开始导通，另一个正反馈过程开始，电路状态又一次发生突变。这时的输入电平称为上门限电压\\(V\_{T+}\\)。

调节M1、M4（或者M5、M6）的宽长比(W/L)，可以调节上下门限电压。定性地说，M1的宽长比越大（或者M5的宽长比越小），则\\(V\_{T-}\\)越高，M4的宽长比越大（或者M6的宽长比越小），则\\(V\_{T+}\\)越低。
